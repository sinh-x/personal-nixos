#!/usr/bin/env bash
# ~/.config/hypr/scripts/generate_workspace_config.sh

CONFIG_FILE="$HOME/.config/hypr/workspaces.conf"
LAPTOP_MONITOR="eDP-1" # Change to your laptop monitor

# Get connected monitors
MONITORS=$(hyprctl monitors -j 2>/dev/null | jq -r '.[].name' 2>/dev/null || hyprctl monitors | grep -oP 'Monitor \K\S+')
EXTERNAL_MONITOR=$(echo "$MONITORS" | grep -v "$LAPTOP_MONITOR" | head -1)

# Generate workspace configuration
cat >"$CONFIG_FILE" <<EOF
# Auto-generated workspace configuration
# Generated on: $(date)

# Monitor setup
monitor = $LAPTOP_MONITOR,preferred,0x0,1
EOF

if [ "$EXTERNAL_MONITOR" != "" ]; then
  cat >>"$CONFIG_FILE" <<EOF
# monitor = $EXTERNAL_MONITOR,preferred,auto,1,
monitor = $EXTERNAL_MONITOR,highrr,auto,1,

# Dual monitor workspace assignment
workspace = 1, monitor:$LAPTOP_MONITOR, persistent:true, default:true
workspace = 2, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 3, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 4, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 5, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 11, monitor:$LAPTOP_MONITOR, persistent:true, default:true
workspace = 12, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 13, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 14, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 15, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 6, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 7, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 8, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 9, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 10, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 16, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 17, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 18, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 19, monitor:$EXTERNAL_MONITOR, persistent:true
workspace = 20, monitor:$EXTERNAL_MONITOR, persistent:true

# Additional keybindings for external monitor workspaces
bind = SUPER, F1, workspace, 11
bind = SUPER, F2, workspace, 12
bind = SUPER, F3, workspace, 13
bind = SUPER, F4, workspace, 14
bind = SUPER, F5, workspace, 15
bind = SUPER, F6, workspace, 16
bind = SUPER, F7, workspace, 17
bind = SUPER, F8, workspace, 18
bind = SUPER, F9, workspace, 19
bind = SUPER, F10, workspace, 20

bind = SUPER_SHIFT, F1, movetoworkspace, 11
bind = SUPER_SHIFT, F2, movetoworkspace, 12
bind = SUPER_SHIFT, F3, movetoworkspace, 13
bind = SUPER_SHIFT, F4, movetoworkspace, 14
bind = SUPER_SHIFT, F5, movetoworkspace, 15
bind = SUPER_SHIFT, F6, movetoworkspace, 16
bind = SUPER_SHIFT, F7, movetoworkspace, 17
bind = SUPER_SHIFT, F8, movetoworkspace, 18
bind = SUPER_SHIFT, F9, movetoworkspace, 19
bind = SUPER_SHIFT, F10, movetoworkspace, 20
EOF
else
  cat >>"$CONFIG_FILE" <<EOF

# Single monitor workspace assignment
workspace = 1, monitor:$LAPTOP_MONITOR, persistent:true, default:true
workspace = 2, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 3, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 4, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 5, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 6, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 7, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 8, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 9, monitor:$LAPTOP_MONITOR, persistent:true
workspace = 10, monitor:$LAPTOP_MONITOR, persistent:true

EOF
fi

echo "Workspace configuration generated: $CONFIG_FILE"

# Reload Hyprland config if running
if pgrep -x "Hyprland" >/dev/null; then
  hyprctl reload
fi
